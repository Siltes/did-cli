#!/usr/bin/env nodejs
/**
 * A Decentralized Identifier client for managing DIDs.
 *
 * Copyright (c) 2017 Digital Bazaar, Inc. All rights reserved.
 */
const async = require('async');
const fs = require('fs');
const mkdirp = require('mkdirp');
const program = require('commander');
const request = require('request');
const veres = require('./lib/driver-veres');
const URL = require('url');
const config = {};

const DID_SERVICE = config.username || 'https://testnet.veres.one/dids';

// add help output
program;

// setup the command line
program
  .usage('command [options]' )
  .description('A program to manage Decentralized Identifiers (DIDs)')
  .on('--help', function(){
    console.log('\n   Examples:');
    console.log('    $ did create');
    console.log('    $ did auth-add -d 1234');
    console.log('    $ did auth-rotate -d 1234');
    console.log('    $ did auth-remove -d 1234');
    console.log('');
  })
  .option('-d, --did [did]', 'The DID to manage')
  .option('-l, --ledger [ledger]', 'The DID ledger to use [veres]',
    /^(veres|sovrin|btcr|uport|consensys)$/i, 'veres')
  .option('-v, --verbose', 'Verbose output')
  .version('0.1.0');

// create a DID
program
  .command('create')
  .description('Create a DID');

// add an authentication key to a DID Document
program
  .command('authn-add')
  .description('Add an authentication key to a DID')
  .option('-d, --did', 'The DID to manage');

// rotate an authentication key for a DID document
program
  .command('authn-rotate')
  .description('Rotate an existing DID authentication key')
  .option('-d, --did', 'The DID to manage')
  .option('-o, --old-key', 'The old key identifier to rotate out');

// add an authorization to a DID Document
program
  .command('authz-add')
  .description('Add an authorization to a DID Document')
  .option('-d, --did', 'The DID to manage');

// remove an authorization from a DID Document
program
  .command('authz-remove')
  .description('Remove an authorization from a DID Document')
  .option('-d, --did', 'The DID to manage');

program.parse(process.argv);

if(!process.argv.slice(2).length) {
}

const command = program.args[0];

if(command === 'create') {
  if(program.ledger === 'veres') {
    veres.create(program);
  } else {
    console.error('Error:', program.ledger, 'ledger not supported yet');
  }
} else if(['authn-add'].indexOf(command) !== -1) {
  console.error('Error:', command, 'not implemented');
} else {
  console.error('Error: Unknown command', command);
  program.outputHelp();
}
