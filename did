#!/usr/bin/env nodejs
/**
 * A Decentralized Identifier client for managing DIDs.
 *
 * Copyright (c) 2017 Digital Bazaar, Inc. All rights reserved.
 */
const async = require('async');
const fs = require('fs');
const mkdirp = require('mkdirp');
const program = require('commander');
const request = require('request');
const veres = require('./lib/driver-veres');
const URL = require('url');
const config = {};

const DID_SERVICE = config.username || 'https://testnet.veres.one/dids';

// add help output
program;

// setup the command line
program
  .usage('command [options]' )
  .description('A program to manage Decentralized Identifiers (DIDs)')
  .on('--help', function(){
    console.log('\n   Examples:');
    console.log('    $ did create');
    console.log('    $ did auth-add -d 1234');
    console.log('    $ did auth-rotate -d 1234');
    console.log('    $ did auth-remove -d 1234');
    console.log('');
  })
  .option('-l, --ledger', 'The DID ledger to use [default: veres]',
    /^(veres|sovrin|btcr|uport|consensys)$/i, 'veres')
  .option('-v, --verbose', 'Verbose output')
  .version('0.1.0');

// create a DID
program
  .command('create')
  .description('Create a DID')
  .option('-d, --did', 'The DID to create')
  .action(cmd => {
    if(program.ledger === 'veres') {
      veres.create(program);
    } else {
      console.error('Could not create DID, unknown ledger:', program.ledger);
    }
  });

// add an authentication key to a DID Document
program
  .command('authn-add')
  .description('Add an authentication key to a DID')
  .option('-d, --did', 'The DID to manage')
  .action(cmd => {
    console.log('Not implemented yet');
  });

// rotate an authentication key for a DID document
program
  .command('authn-rotate')
  .description('Rotate an existing authentication key for a DID')
  .option('-d, --did', 'The DID to manage')
  .option('-o, --old-key', 'The old key identifier to rotate out')
  .action(cmd => {
    console.log('Not implemented yet');
  });

// add an authorization to a DID Document
program
  .command('authz-add')
  .description('Add an authorization to a DID Document')
  .option('-d, --did', 'The DID to manage')
  .action(cmd => {
    console.log('Not implemented yet');
  });

// remove an authorization from a DID Document
program
  .command('authz-remove')
  .description('Remove an authorization from a DID Document')
  .option('-d, --did', 'The DID to manage')
  .action(cmd => {
    console.log('Not implemented yet');
  });

// catch all for unknown command
program
  .command('*', 'Unknown command catch-all', {noHelp:true})
  .action(cmd => {
    console.log('Error: Unknown command');
    program.help();
  });

program.parse(process.argv);

if(!process.argv.slice(2).length) {
  program.outputHelp();
}
